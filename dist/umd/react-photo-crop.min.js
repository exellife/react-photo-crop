!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactPhotoCrop={},e.React)}(this,(function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var r=new class{constructor(){this.styles={modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%",background:"rgba(0, 0, 0, 0.548)"},window:{position:"relative",top:"15%",margin:"0 auto",padding:"20px",maxWidth:"600px",background:"rgb(0, 0, 0)",borderRadius:"2px",boxShadow:"",display:"flex",flexDirection:"column"},cropOut:{position:"relative",padding:"12px 12px 20px",overflow:"hidden",background:"transparent"},crop:{padding:"20px",display:"block"},cropIn:{margin:"auto",width:"240px",height:"240px",position:"relative",display:"block"},photoCrop:{width:"100%",height:"100%",position:"relative",display:"block"},img:{position:"absolute",cursor:"move"},after:{content:"",position:"absolute",boxShadow:"0 0 100vw 10vh rgba(0, 0, 0, 0.788)",top:"0",bottom:"0",left:"0",right:"0",borderRadius:"100%",pointerEvents:"none"},zoom:{padding:"8px",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},rangeWrap:{boxSizing:"border-box",padding:"8px",width:"260px",display:"flex",alignItems:"center",justifyContent:"center"},range:{width:"100%",cursor:"pointer"},rangeVal:{marginLeft:"4px"},buttons:{display:"flex",justifyContent:"flex-end",padding:"10px 10px 0"},cancelBtn:{},actionBtn:{},inputFileBtn:{}},this.classes={modal:["rpc-modal"],window:["rpc-window"],cropOut:["rpc-crop-out"],crop:["rpc-crop"],cropIn:["rpc-crop-in"],photoCrop:["rpc-photo-crop"],img:["rpc-img"],after:["rpc-after"],rangeWrap:["rpc-range-wrap"],rangeVal:["rpc-range-val"],cancelBtn:["rpc-cancel-btn"],actionBtn:["rpc-action-btn"],inputFileBtn:["rpc-input-file"]},this.ids={photoCrop:"rpc-photo-crop",img:"rpc-img",zoom:"rpc-zoom",buttons:"rpc-buttons",inputFileBtn:"rpc-input-file-btn"},this.nameValues={inputFileBtn:"Change",cancelBtn:"Cancel",actionBtn:"Upload"}}addStyle(e,t){for(var n in this.styles)n===e&&(this.styles[n]=o(o({},this.styles[n]),t))}addClassName(e,t){this.classes[e]&&(Array.isArray(t)?this.classes[e]=this.classes[e].concat(t):this.classes[e].push(t))}removeClassName(e,t){if(this.classes[e]){var n=[];for(var a of this.classes[e])a!==t&&n.push(t);this.classes[e]=n}}setBtnName(e,t){this.nameValues[e]=t}get config(){return{styles:this.styles,classes:this.classes,ids:this.ids,nameValues:this.nameValues}}};var i="open",s="close",c="setImageConfig",l="setBoundaries",p="setMouseCoords",u="setImageSrc",d={open:!1,imageConfig:{width:"",height:"",top:"50%",left:"50%",transform:""},boundaries:{top:0,bottom:0,left:0,right:0},imageSrc:""};function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return o(o({},e),{},{open:!0});case s:return o(o({},e),{},{open:!1});case c:return o(o({},e),{},{imageConfig:o(o({},e.imageConfig),t.payload)});case l:return o(o({},e),{},{boundaries:o({},t.payload)});case p:return o(o({},e),{},{mouseCoords:o({},t.payload)});case u:return o(o({},e),{},{open:!0,imageSrc:t.payload});default:throw Error("Shouldn't have happend")}}var g=t.createContext(d),f=t.useEffect,h=t.useState,y=t.useContext,b=t.useRef;function v(e){var{id:n,imgStyles:a,classNames:r}=e,{state:i,setDimensions:s,setTransform:c,setImageBounds:l}=y(g),p=b(),u=i.imageSrc?i.imageSrc:"",[d,m]=h(!1),v=function(){var e={x:null,y:null};return{X:function(){return e.x},Y:function(){return e.y},setX:function(t){e.x=t},setY:function(t){e.y=t},getCoords:function(){return e}}}();return f(()=>{c("translate3d(-50%, -50%, 0)"),s(u);var{top:e,bottom:t,left:n,right:a}=p.current.getBoundingClientRect();l({top:e,bottom:t,left:n,right:a})},[u]),f(()=>{var{top:e,bottom:t,left:n,right:a}=p.current.getBoundingClientRect();l({top:e,bottom:t,left:n,right:a})},[i.imageConfig]),t.createElement("img",{src:u,alt:"image being cropped...",ref:p,id:n,draggable:!1,style:o(o({},a),i.imageConfig),onMouseDown:e=>{m(!0)},onMouseUp:e=>{m(!1)},onMouseMove:e=>function(e){if(d){var t=e.target,{clientX:n,clientY:a}=e,{top:o,bottom:r,left:s,right:p}=t.getBoundingClientRect();l({top:o,bottom:r,left:s,right:p}),v.X()||v.setX(n),v.Y()||v.setY(a);var[u,m]=[v.X(),v.Y()];function g(e){var t,n=i.imageConfig.transform,[a,o,r]=[+(t=n.match(/([\-]?\d+)/gm))[1],+t[2],+t[3]];"right"===e?a++:"left"===e?a--:"down"===e?o++:"up"===e&&o--;var s="translate3d(".concat(a,"%, ").concat(o,"%, ").concat(r,")");c(s)}n>u&&(v.setX(n-1),s<i.boundaries.left&&g("right")),n<u&&(v.setX(n+1),p>i.boundaries.right&&g("left")),a>m&&(v.setY(a-1),o<i.boundaries.top&&g("down")),a<m&&(v.setY(a+1),r>i.boundaries.bottom&&g("up"))}}(e),onMouseLeave:e=>{m(!1)},className:r})}var w=t.useEffect,C=t.useRef,B=t.useContext;function x(e){var{id:n,pcStyles:a,classNames:r}=e,{setBoundaries:i}=B(g),s=C();return w(()=>{i(s.current)},[]),t.createElement("div",{id:n,style:o({},a),ref:s,className:r})}var S=t.useState,E=t.useContext;function j(e){var{id:n,zoomStyles:a,rangeWrap:r,rangeStyles:i,rangeVal:s,classNames:c}=e,{zoom:l}=E(g),[p,u]=S(0),{rangeWrapCls:d,rangeValCls:m}=c;return t.createElement("div",{id:n,style:o({},a)},t.createElement("div",{className:d,style:o({},r)},t.createElement("input",{id:"rpc-range",type:"range",min:"0",max:"5",value:p,onChange:e=>function(e){e.preventDefault(),l(+e.target.value),u(e.target.value)}(e),step:"1",style:o({},i)}),t.createElement("span",{className:m,style:o({},s)},p)))}var N=t.useContext;function R(e){var{ids:n,btnStyles:a,btnNames:r,classNames:i,rpcHandler:s}=e,{buttonId:c}=n,{closeModal:l}=N(g),{actionBtn:p,cancelBtn:u}=i,{actionBtnStyle:d,cancelBtnStyle:m,buttonStyles:f}=a,{actionBtnName:h,cancelBtnName:y}=r;return t.createElement("div",{id:c,style:o({},f)},t.createElement("button",{style:o({},d),className:p,onClick:e=>function(e){s(e),l()}(e)},h),t.createElement("button",{style:o({},m),className:u,onClick:e=>l()},y))}var O=new class{constructor(){this.imgInstance=null,this.boundaries={},this._imageSrc={},this.canvas=null,this.size={width:"",height:""}}set imageSrc(e){this._imageSrc=e}setBoundaries(e){this.boundaries=o({},e)}setImageBounds(e){this.imageBounds=o({},e)}setCanvas(e){this.canvas=e}setSize(e){this.size=o({},e)}getDataURL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rpc-img";e||(e="rpc-img");var t=document.getElementById(e);if(!t)throw Error("Could not find any image with id ".concat(e,"... if you changed default styles, make sure to pass an 'id' to useRPC.getDataURL function in the component where it called"));var[n,a]=[t.width,t.height],o=!1,r=20,i="",s=document.createElement("canvas");s.width=240,s.height=240;var c=s.getContext("2d"),l=this.boundaries,p=this.imageBounds,u=l.left-p.left,d=l.top-p.top,[m,g]=[240,240],f=new Image(n,a);return f.onload=()=>{var e=document.createElement("canvas");e.width=n,e.height=a,e.getContext("2d").drawImage(f,0,0,n,a),c.drawImage(e,u,d,m,g,0,0,240,240),i=s.toDataURL(),o=!0},f.src=this._imageSrc,new Promise((e,t)=>{!function n(){r?(r--,o&&e(i),o||setTimeout(n,300)):t("There is an issues reeding file")}()})}},P=t.useContext,I=t.useEffect,z=t.useRef;var D=t.useReducer;e.RPCButton=function(e){var{styles:n,classes:a,nameValues:r,ids:i}=e,s=z(),{state:c,setImageSrc:l}=P(g);return I(()=>{c.open||(s.current.value="")},[c.open]),t.createElement("label",{htmlFor:i.inputFileBtn,style:o({},n.inputFileBtnStyles),className:a.inputFileBtn.join(" ")},r.inputFileBtn,t.createElement("input",{ref:s,type:"file",accept:"image/png, image/jpeg, image/webp",id:i.inputFileBtn,onChange:e=>function(e){var t=e.target.files[0];if(t){var n=new FileReader;if(n.onload=e=>{l(n.result)},t.type&&-1===t.type.indexOf("image"))throw Error("File is not an image: ".concat(t.type,", ").concat(t));n.readAsDataURL(t)}}(e),style:{visibility:"hidden",width:"0.1px"}}))},e.RPCCtxState=function(e){var{children:n}=e,[a,o]=D(m,d);return t.createElement(g.Provider,{value:{setBoundaries:function(e){var{top:t,bottom:n,left:a,right:r}=e.getBoundingClientRect();o({type:l,payload:{top:t,bottom:n,left:a,right:r}}),O.setBoundaries({top:t,bottom:n,left:a,right:r})},setDimensions:function(e){var t,n,[a,r]=["100%","auto"],i=new Image;i.onload=function(){[t,n]=i.height>i.width?[r,a]:[a,r],o({type:c,payload:{width:n,height:t}})},i.src=e,O.imageSrc=e},setTransform:function(e){o({type:c,payload:{transform:e}})},setImageBounds:function(e){O.setImageBounds(e)},setImageSrc:function(e){O.image=e,o({type:u,payload:e})},setCanvas:function(e){O.setCanvas(e)},zoom:function(e){if(!(e>5||e<0)){var t=0===e?100:1===e?120:2===e?140:3===e?160:4===e?180:5===e?200:null,{width:n,height:r}=a.imageConfig;"auto"===n?(O.setSize({width:n,height:"".concat(t,"%")}),o({type:c,payload:{width:n,height:"".concat(t,"%"),transform:"translate3d(-50%, -50%, 0)"}})):(O.setSize({width:"".concat(t,"%"),height:r}),o({type:c,payload:{width:"".concat(t,"%"),height:r,transform:"translate3d(-50%, -50%, 0)"}}))}},closeModal:function(){o({type:s})},openModal:function(){o({type:i})},state:a}},n)},e.RPCModal=function(e){var{styles:n,classes:a,ids:r,nameValues:i,rpcHandler:s}=e;if(!(n&&a&&r&&i))throw Error("most likely RPCStyles configs were not passed to component -> RPCModal");if(!s)throw Error("handler function wasn't provided to component -> RPCModal");var{state:c}=P(g);return t.createElement(t.Fragment,null,c.open?t.createElement("div",{className:a.modal.join(" "),style:o({},n.modal)},t.createElement("div",{className:a.window.join(" "),style:o({},n.window)},t.createElement("div",{className:a.cropOut.join(" "),style:o({},n.cropOut)},t.createElement("div",{className:a.crop.join(" "),style:o({},n.crop)},t.createElement("div",{className:a.cropIn.join(" "),style:o({},n.cropIn)},t.createElement(x,{classNames:a.photoCrop.join(" "),id:r.photoCrop,pcStyles:n.photoCrop}),t.createElement(v,{imgStyles:n.img,id:r.img,classNames:a.img.join(" ")}),t.createElement("div",{className:a.after.join(" "),style:o({},n.after)})))),t.createElement(j,{id:r.zoom,zoomStyles:n.zoom,rangeWrap:n.rangeWrap,rangeStyles:n.range,rangeVal:n.rangeVal,classNames:{rangeWrapCls:a.rangeWrap.join(" "),rangeValCls:a.rangeVal.join(" ")}}),t.createElement(R,{id:r.buttons,ids:{buttonsId:r.buttons},classNames:{cancelBtn:a.cancelBtn.join(" "),actionBtn:a.actionBtn.join(" ")},btnStyles:{actionBtnStyle:n.actionBtn,cancelBtnStyle:n.cancelBtn,buttonStyles:n.buttons},btnNames:{cancelBtnName:i.cancelBtn,actionBtnName:i.actionBtn},rpcHandler:s}))):null)},e.RPCStyles=r,e.useRPC=function(){return{getDataURL:()=>O.getDataURL()}},Object.defineProperty(e,"__esModule",{value:!0})}));
