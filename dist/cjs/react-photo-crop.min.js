"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("react"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var r=new class{constructor(){this.styles={modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%",background:"rgba(0, 0, 0, 0.548)"},window:{position:"relative",top:"15%",margin:"0 auto",padding:"20px",maxWidth:"600px",background:"rgb(0, 0, 0)",borderRadius:"2px",boxShadow:"",display:"flex",flexDirection:"column"},cropOut:{position:"relative",padding:"12px 12px 20px",overflow:"hidden",background:"transparent"},crop:{padding:"20px",display:"block"},cropIn:{margin:"auto",width:"240px",height:"240px",position:"relative",display:"block"},photoCrop:{width:"100%",height:"100%",position:"relative",display:"block"},img:{position:"absolute",cursor:"move"},after:{content:"",position:"absolute",boxShadow:"0 0 100vw 10vh rgba(0, 0, 0, 0.788)",top:"0",bottom:"0",left:"0",right:"0",borderRadius:"100%",pointerEvents:"none"},modalBtn:{},zoom:{padding:"8px",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},rangeWrap:{boxSizing:"border-box",padding:"8px",width:"260px",display:"flex",alignItems:"center",justifyContent:"center"},range:{width:"100%",cursor:"pointer"},rangeVal:{marginLeft:"4px"},buttons:{display:"flex",justifyContent:"flex-end",padding:"10px 10px 0"},cancelBtn:{},actionBtn:{},inputFileBtn:{}},this.classes={modal:["rpc-modal"],window:["rpc-window"],cropOut:["rpc-crop-out"],crop:["rpc-crop"],cropIn:["rpc-crop-in"],photoCrop:["rpc-photo-crop"],img:["rpc-img"],after:["rpc-after"],modalBtn:["rpc-btn"],rangeWrap:["rpc-range-wrap"],rangeVal:["rpc-range-val"],cancelBtn:["rpc-cancel-btn"],actionBtn:["rpc-action-btn"],inputFileBtn:["rpc-input-file"]},this.ids={photoCrop:"rpc-photo-crop",img:"rpc-img",zoom:"rpc-zoom",buttons:"rpc-buttons",inputFileBtn:"rpc-input-file-btn"},this.nameValues={modalBtn:"Upload",cancelBtn:"Cancel",actionBtn:"Upload"}}addStyle(e,t){for(var n in this.styles)n===e&&(this.styles[n]=o(o({},this.styles[n]),t))}addClassName(e,t){this.classes[e]&&(Array.isArray(t)?this.classes[e]=this.classes[e].concat(t):this.classes[e].push(t))}removeClassName(e,t){if(this.classes[e]){var n=[];for(var a of this.classes[e])a!==t&&n.push(t);this.classes[e]=n}}setBtnName(e,t){this.nameValues[e]=t}get config(){return{styles:this.styles,classes:this.classes,ids:this.ids,nameValues:this.nameValues}}};var i="open",s="close",l="setImageConfig",c="setBoundaries",p="setMouseCoords",u="setImageSrc",d={open:!1,imageConfig:{width:"",height:"",top:"50%",left:"50%",transform:""},boundaries:{top:0,bottom:0,left:0,right:0},imageSrc:""};function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return o(o({},e),{},{open:!0});case s:return o(o({},e),{},{open:!1});case l:return o(o({},e),{},{imageConfig:o(o({},e.imageConfig),t.payload)});case c:return o(o({},e),{},{boundaries:o({},t.payload)});case p:return o(o({},e),{},{mouseCoords:o({},t.payload)});case u:return o(o({},e),{},{imageSrc:t.payload});default:throw Error("Shouldn't have happend")}}var g=t.createContext(d),f=t.useEffect,h=t.useState,y=t.useContext,v=t.useRef;function b(e){var{id:n,imgStyles:a,defaultSrc:r,classNames:i}=e,{state:s,setDimensions:l,setTransform:c,setImageBounds:p}=y(g),u=v(),d=s.imageSrc?s.imageSrc:r,[m,b]=h(!1),w=function(){var e={x:null,y:null};return{X:function(){return e.x},Y:function(){return e.y},setX:function(t){e.x=t},setY:function(t){e.y=t},getCoords:function(){return e}}}();return f(()=>{c("translate3d(-50%, -50%, 0)"),l(d);var{top:e,bottom:t,left:n,right:a}=u.current.getBoundingClientRect();p({top:e,bottom:t,left:n,right:a})},[d]),f(()=>{var{top:e,bottom:t,left:n,right:a}=u.current.getBoundingClientRect();p({top:e,bottom:t,left:n,right:a})},[s.imageConfig]),t.createElement("img",{src:d,alt:"image being cropped...",ref:u,id:n,draggable:!1,style:o(o({},a),s.imageConfig),onMouseDown:e=>{b(!0)},onMouseUp:e=>{b(!1)},onMouseMove:e=>function(e){if(m){var t=e.target,{clientX:n,clientY:a}=e,{top:o,bottom:r,left:i,right:l}=t.getBoundingClientRect();p({top:o,bottom:r,left:i,right:l}),w.X()||w.setX(n),w.Y()||w.setY(a);var[u,d]=[w.X(),w.Y()];function g(e){var t,n=s.imageConfig.transform,[a,o,r]=[+(t=n.match(/([\-]?\d+)/gm))[1],+t[2],+t[3]];"right"===e?a++:"left"===e?a--:"down"===e?o++:"up"===e&&o--;var i="translate3d(".concat(a,"%, ").concat(o,"%, ").concat(r,")");c(i)}n>u&&(w.setX(n-1),i<s.boundaries.left&&g("right")),n<u&&(w.setX(n+1),l>s.boundaries.right&&g("left")),a>d&&(w.setY(a-1),o<s.boundaries.top&&g("down")),a<d&&(w.setY(a+1),r>s.boundaries.bottom&&g("up"))}}(e),onMouseLeave:e=>{b(!1)},className:i})}var w=t.useEffect,C=t.useRef,B=t.useContext;function S(e){var{id:n,pcStyles:a,classNames:r}=e,{setBoundaries:i}=B(g),s=C();return w(()=>{i(s.current)},[]),t.createElement("div",{id:n,style:o({},a),ref:s,className:r})}var x=t.useState,E=t.useContext;function j(e){var{id:n,zoomStyles:a,rangeWrap:r,rangeStyles:i,rangeVal:s,classNames:l}=e,{zoom:c}=E(g),[p,u]=x(0),{rangeWrapCls:d,rangeValCls:m}=l;return t.createElement("div",{id:n,style:o({},a)},t.createElement("div",{className:d,style:o({},r)},t.createElement("input",{id:"rpc-range",type:"range",min:"0",max:"5",value:p,onChange:e=>function(e){e.preventDefault(),c(+e.target.value),u(e.target.value)}(e),step:"1",style:o({},i)}),t.createElement("span",{className:m,style:o({},s)},p)))}var N=t.useContext;function R(e){var{ids:n,btnStyles:a,btnNames:r,classNames:i,rpcHandler:s}=e,{buttonId:l,inputFileId:c}=n,{closeModal:p,setImageSrc:u}=N(g),{actionBtn:d,cancelBtn:m,inputFileBtn:f}=i,{actionBtnStyle:h,cancelBtnStyle:y,buttonStyles:v,inputFileBtnStyles:b}=a,{actionBtnName:w,cancelBtnName:C}=r;return t.createElement("div",{id:l,style:o({},v)},t.createElement("input",{type:"file",accept:"image/png, image/jpeg, image/webp",id:c,style:o({},b),className:f,onChange:e=>function(e){var t=e.target.files[0];if(t){var n=new FileReader;if(n.onload=e=>{u(n.result)},t.type&&-1===t.type.indexOf("image"))throw Error("File is not an image: ".concat(t.type,", ").concat(t));n.readAsDataURL(t)}}(e)}),t.createElement("button",{style:o({},h),className:d,onClick:e=>function(e){s(e),p()}(e)},w),t.createElement("button",{style:o({},y),className:m,onClick:e=>p()},C))}var I=new class{constructor(){this.imgInstance=null,this.boundaries={},this._imageSrc={},this.canvas=null,this.size={width:"",height:""}}set imageSrc(e){this._imageSrc=e}setBoundaries(e){this.boundaries=o({},e)}setImageBounds(e){this.imageBounds=o({},e)}setCanvas(e){this.canvas=e}setSize(e){this.size=o({},e)}getDataURL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rpc-img";e||(e="rpc-img");var t=document.getElementById(e);if(!t)throw Error("Could not find any image with id ".concat(e,"... if you changed default styles, make sure to pass an 'id' to useRPC.getDataURL function in the component where it called"));var[n,a]=[t.width,t.height],o=!1,r=20,i="",s=document.createElement("canvas");s.width=240,s.height=240;var l=s.getContext("2d"),c=this.boundaries,p=this.imageBounds,u=c.left-p.left,d=c.top-p.top,[m,g]=[240,240],f=new Image(n,a);return f.onload=()=>{var e=document.createElement("canvas");e.width=n,e.height=a,e.getContext("2d").drawImage(f,0,0,n,a),l.drawImage(e,u,d,m,g,0,0,240,240),i=s.toDataURL(),o=!0},f.src=this._imageSrc,new Promise((e,t)=>{!function n(){r?(r--,o&&e(i),o||setTimeout(n,300)):t("There is an issues reeding file")}()})}},O=t.useContext;var P=t.useReducer;exports.RPCButton=function(e){var{styles:n,classes:a,nameValues:r}=e;if(!n||!a||!r)throw Error("most likely RPCStyles configs were not passed to component -> RPCButton");var{openModal:i}=O(g),{modalBtn:s}=r;return t.createElement("button",{className:a.modalBtn.join(" "),style:o({},n.modalBtn),onClick:e=>i()},s)},exports.RPCCtxState=function(e){var{children:n}=e,[a,o]=P(m,d);return t.createElement(g.Provider,{value:{setBoundaries:function(e){var{top:t,bottom:n,left:a,right:r}=e.getBoundingClientRect();o({type:c,payload:{top:t,bottom:n,left:a,right:r}}),I.setBoundaries({top:t,bottom:n,left:a,right:r})},setDimensions:function(e){var t,n,[a,r]=["100%","auto"],i=new Image;i.onload=function(){[t,n]=i.height>i.width?[r,a]:[a,r],o({type:l,payload:{width:n,height:t}})},i.src=e,I.imageSrc=e},setTransform:function(e){o({type:l,payload:{transform:e}})},setImageBounds:function(e){I.setImageBounds(e)},setImageSrc:function(e){I.image=e,o({type:u,payload:e})},setCanvas:function(e){I.setCanvas(e)},zoom:function(e){if(!(e>5||e<0)){var t=0===e?100:1===e?120:2===e?140:3===e?160:4===e?180:5===e?200:null,{width:n,height:r}=a.imageConfig;"auto"===n?(I.setSize({width:n,height:"".concat(t,"%")}),o({type:l,payload:{width:n,height:"".concat(t,"%"),transform:"translate3d(-50%, -50%, 0)"}})):(I.setSize({width:"".concat(t,"%"),height:r}),o({type:l,payload:{width:"".concat(t,"%"),height:r,transform:"translate3d(-50%, -50%, 0)"}}))}},closeModal:function(){o({type:s})},openModal:function(){o({type:i})},doTheJob:function(){return I.calculate()},state:a}},n)},exports.RPCModal=function(e){var{styles:n,classes:a,ids:r,nameValues:i,defaultSrc:s,rpcHandler:l}=e;if(!(n&&a&&r&&i))throw Error("most likely RPCStyles configs were not passed to component -> RPCModal");if(!s)throw Error("default image source was not provided to component -> RPCModal ");if(!l)throw Error("handler function wasn't provided to component -> RPCModal");var{state:c}=O(g);return t.createElement(t.Fragment,null,c.open?t.createElement("div",{className:a.modal.join(" "),style:o({},n.modal)},t.createElement("div",{className:a.window.join(" "),style:o({},n.window)},t.createElement("div",{className:a.cropOut.join(" "),style:o({},n.cropOut)},t.createElement("div",{className:a.crop.join(" "),style:o({},n.crop)},t.createElement("div",{className:a.cropIn.join(" "),style:o({},n.cropIn)},t.createElement(S,{classNames:a.photoCrop.join(" "),id:r.photoCrop,pcStyles:n.photoCrop}),t.createElement(b,{imgStyles:n.img,id:r.img,defaultSrc:s,classNames:a.img.join(" ")}),t.createElement("div",{className:a.after.join(" "),style:o({},n.after)})))),t.createElement(j,{id:r.zoom,zoomStyles:n.zoom,rangeWrap:n.rangeWrap,rangeStyles:n.range,rangeVal:n.rangeVal,classNames:{rangeWrapCls:a.rangeWrap.join(" "),rangeValCls:a.rangeVal.join(" ")}}),t.createElement(R,{id:r.buttons,ids:{buttonsId:r.buttons,inputFileId:r.inputFileBtn},classNames:{cancelBtn:a.cancelBtn.join(" "),actionBtn:a.actionBtn.join(" "),inputFileBtn:a.inputFileBtn.join(" ")},btnStyles:{actionBtnStyle:n.actionBtn,cancelBtnStyle:n.cancelBtn,buttonStyles:n.buttons,inputFileBtnStyles:n.inputFileBtn},btnNames:{cancelBtnName:i.cancelBtn,actionBtnName:i.actionBtn},rpcHandler:l}))):null)},exports.RPCStyles=r,exports.useRPC=function(){return{getDataURL:()=>I.getDataURL()}};
