"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("react"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var r=new class{constructor(){this.styles={modal:{position:"absolute",top:"0",bottom:"0",right:"0",left:"0",background:"rgba(0, 0, 0, 0.74)"},window:{position:"relative",top:"15%",margin:"0 auto",padding:"20px",maxWidth:"600px",background:"rgb(0, 0, 0)",borderRadius:"2px",boxShadow:"",display:"flex",flexDirection:"column"},cropOut:{position:"relative",padding:"12px 12px 20px",overflow:"hidden",background:"transparent"},crop:{padding:"20px"},cropIn:{margin:"auto",width:"240px",height:"240px",position:"relative"},photoCrop:{width:"100%",height:"100%",position:"relative"},img:{position:"absolute",cursor:"move"},after:{content:"",position:"absolute",boxShadow:"0 0 100vw 10vh rgba(0, 0, 0, 0.788)",top:"0",bottom:"0",left:"0",right:"0",borderRadius:"100%",pointerEvents:"none"},modalBtn:{},zoom:{padding:"8px",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},rangeWrap:{boxSizing:"border-box",padding:"8px",width:"260px",display:"flex",alignItems:"center",justifyContent:"center"},range:{width:"100%",cursor:"pointer"},rangeVal:{marginLeft:"4px"},buttons:{display:"flex",justifyContent:"flex-end",padding:"10px 10px 0"},cancelBtn:{},actionBtn:{},inputFileBtn:{}},this.classes={modal:"rpc-modal",window:"rpc-window",cropOut:"rpc-crop-out",crop:"rpc-crop",cropIn:"rpc-crop-in",after:"rpc-after",modalBtn:"rpc-btn",rangeWrap:"rpc-range-wrap",rangeVal:"rpc-range-val",cancelBtn:"rpc-cancel-btn",actionBtn:"rpc-action-btn",inputFileBtn:"rpc-input-file"},this.ids={photoCrop:"rpc-photo-crop",img:"rpc-img",zoom:"rpc-zoom",buttons:"rpc-buttons",inputFileBtn:"rpc-input-file-btn"},this.nameValues={modalBtn:"Upload",cancelBtn:"Cancel",actionBtn:"Upload"}}addStyle(e,t){for(var n in this.styles)n===e&&(this.styles[n]=o(o({},this.styles[n]),t))}setBtnName(e,t){this.nameValues[e]=t}get config(){return{styles:this.styles,classes:this.classes,ids:this.ids,nameValues:this.nameValues}}};var i="open",s="close",c="setImageConfig",l="setBoundaries",u="setMouseCoords",p="setImageSrc",d={open:!1,imageConfig:{width:"",height:"",top:"50%",left:"50%",transform:""},boundaries:{top:0,bottom:0,left:0,right:0},imageSrc:""};function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return o(o({},e),{},{open:!0});case s:return o(o({},e),{},{open:!1});case c:return o(o({},e),{},{imageConfig:o(o({},e.imageConfig),t.payload)});case l:return o(o({},e),{},{boundaries:o({},t.payload)});case u:return o(o({},e),{},{mouseCoords:o({},t.payload)});case p:return o(o({},e),{},{imageSrc:t.payload});default:throw Error("Shouldn't have happend")}}var m=t.createContext(d),f=t.useEffect,h=t.useState,y=t.useContext,b=t.useRef;function v(e){var{id:n,imgStyles:a,defaultSrc:r}=e,{state:i,setDimensions:s,setTransform:c,setImageBounds:l}=y(m),u=b(),p=i.imageSrc?i.imageSrc:r,[d,g]=h(!1),v=function(){var e={x:null,y:null};return{X:function(){return e.x},Y:function(){return e.y},setX:function(t){e.x=t},setY:function(t){e.y=t},getCoords:function(){return e}}}();return f(()=>{c("translate3d(-50%, -50%, 0)"),s(p);var{top:e,bottom:t,left:n,right:a}=u.current.getBoundingClientRect();l({top:e,bottom:t,left:n,right:a})},[p]),f(()=>{var{top:e,bottom:t,left:n,right:a}=u.current.getBoundingClientRect();l({top:e,bottom:t,left:n,right:a})},[i.imageConfig]),t.createElement("img",{src:p,alt:"image being cropped...",ref:u,id:n,draggable:!1,style:o(o({},a),i.imageConfig),onMouseDown:e=>{g(!0)},onMouseUp:e=>{g(!1)},onMouseMove:e=>function(e){if(d){var t=e.target,{clientX:n,clientY:a}=e,{top:o,bottom:r,left:s,right:u}=t.getBoundingClientRect();l({top:o,bottom:r,left:s,right:u}),v.X()||v.setX(n),v.Y()||v.setY(a);var[p,g]=[v.X(),v.Y()];function m(e){var t,n=i.imageConfig.transform,[a,o,r]=[+(t=n.match(/([\-]?\d+)/gm))[1],+t[2],+t[3]];"right"===e?a++:"left"===e?a--:"down"===e?o++:"up"===e&&o--;var s="translate3d(".concat(a,"%, ").concat(o,"%, ").concat(r,")");c(s)}n>p&&(v.setX(n-1),s<i.boundaries.left&&m("right")),n<p&&(v.setX(n+1),u>i.boundaries.right&&m("left")),a>g&&(v.setY(a-1),o<i.boundaries.top&&m("down")),a<g&&(v.setY(a+1),r>i.boundaries.bottom&&m("up"))}}(e),onMouseLeave:e=>{g(!1)}})}var w=t.useEffect,B=t.useRef,C=t.useContext;function S(e){var{id:n,pcStyles:a}=e,{setBoundaries:r}=C(m),i=B();return w(()=>{r(i.current)},[]),t.createElement("div",{id:n,style:o({},a),ref:i})}var x=t.useState,E=t.useContext;function I(e){var{id:n,zoomStyles:a,rangeWrap:r,rangeStyles:i,rangeVal:s,classNames:c}=e,{zoom:l}=E(m),[u,p]=x(0),{rangeWrapCls:d,rangeValCls:g}=c;return t.createElement("div",{id:n,style:o({},a)},t.createElement("div",{className:d,style:o({},r)},t.createElement("input",{id:"rpc-range",type:"range",min:"0",max:"5",value:u,onChange:e=>function(e){e.preventDefault(),l(+e.target.value),p(e.target.value)}(e),step:"1",style:o({},i)}),t.createElement("span",{className:g,style:o({},s)},u)))}var O=t.useContext;function N(e){var{ids:n,btnStyles:a,btnNames:r,classNames:i,rpcHandler:s}=e,{buttonId:c,inputFileId:l}=n,{closeModal:u,setImageSrc:p}=O(m),{actionBtn:d,cancelBtn:g,inputFileBtn:f}=i,{actionBtnStyle:h,cancelBtnStyle:y,buttonStyles:b,inputFileBtnStyles:v}=a,{actionBtnName:w,cancelBtnName:B}=r;return t.createElement("div",{id:c,style:o({},b)},t.createElement("input",{type:"file",accept:"image/png, image/jpeg, image/webp",id:l,style:o({},v),className:f,onChange:e=>function(e){var t=e.target.files[0];if(t){var n=new FileReader;if(n.onload=e=>{p(n.result)},t.type&&-1===t.type.indexOf("image"))throw Error("File is not an image: ".concat(t.type,", ").concat(t));n.readAsDataURL(t)}}(e)}),t.createElement("button",{style:o({},h),className:d,onClick:e=>function(e){s(e),u()}(e)},w),t.createElement("button",{style:o({},y),className:g,onClick:e=>u()},B))}var R=new class{constructor(){this.imgInstance=null,this.boundaries={},this._imageSrc={},this.canvas=null,this.size={width:"",height:""}}set imageSrc(e){this._imageSrc=e}setBoundaries(e){this.boundaries=o({},e)}setImageBounds(e){this.imageBounds=o({},e)}setCanvas(e){this.canvas=e}setSize(e){this.size=o({},e)}getDataURL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rpc-img";e||(e="rpc-img");var t=document.getElementById(e);if(!t)throw Error("Could not find any image with id ".concat(e,"... if you changed default styles, make sure to pass an 'id' to useRPC.getDataURL function in the component where it called"));var[n,a]=[t.width,t.height],o=!1,r=20,i="",s=document.createElement("canvas");s.width=240,s.height=240;var c=s.getContext("2d"),l=this.boundaries,u=this.imageBounds,p=l.left-u.left,d=l.top-u.top,[g,m]=[240,240],f=new Image(n,a);return f.onload=()=>{var e=document.createElement("canvas");e.width=n,e.height=a,e.getContext("2d").drawImage(f,0,0,n,a),c.drawImage(e,p,d,g,m,0,0,240,240),i=s.toDataURL(),o=!0},f.src=this._imageSrc,new Promise((e,t)=>{!function n(){r?(r--,o&&e(i),o||setTimeout(n,300)):t("There is an issues reeding file")}()})}},j=t.useContext;var P=t.useReducer;exports.RPCButton=function(e){var{styles:n,classes:a,nameValues:r}=e,{openModal:i}=j(m),{modalBtn:s}=r;return t.createElement("button",{className:a.modalBtn,style:o({},n.modalBtn),onClick:e=>i()},s)},exports.RPCCtxState=function(e){var{children:n}=e,[a,o]=P(g,d);return t.createElement(m.Provider,{value:{setBoundaries:function(e){var{top:t,bottom:n,left:a,right:r}=e.getBoundingClientRect();o({type:l,payload:{top:t,bottom:n,left:a,right:r}}),R.setBoundaries({top:t,bottom:n,left:a,right:r})},setDimensions:function(e){var t,n,[a,r]=["100%","auto"],i=new Image;i.onload=function(){[t,n]=i.height>i.width?[r,a]:[a,r],o({type:c,payload:{width:n,height:t}})},i.src=e,R.imageSrc=e},setTransform:function(e){o({type:c,payload:{transform:e}})},setImageBounds:function(e){R.setImageBounds(e)},setImageSrc:function(e){R.image=e,o({type:p,payload:e})},setCanvas:function(e){R.setCanvas(e)},zoom:function(e){if(!(e>5||e<0)){var t=0===e?100:1===e?120:2===e?140:3===e?160:4===e?180:5===e?200:null,{width:n,height:r}=a.imageConfig;"auto"===n?(R.setSize({width:n,height:"".concat(t,"%")}),o({type:c,payload:{width:n,height:"".concat(t,"%"),transform:"translate3d(-50%, -50%, 0)"}})):(R.setSize({width:"".concat(t,"%"),height:r}),o({type:c,payload:{width:"".concat(t,"%"),height:r,transform:"translate3d(-50%, -50%, 0)"}}))}},closeModal:function(){o({type:s})},openModal:function(){o({type:i})},doTheJob:function(){return R.calculate()},state:a}},n)},exports.RPCModal=function(e){var{styles:n,classes:a,ids:r,defaultSrc:i,nameValues:s,rpcHandler:c}=e;if(!c)throw Error("handler function wasn't provided.");var{state:l}=j(m);return t.createElement(t.Fragment,null,l.open?t.createElement("div",{className:a.modal,style:o({},n.modal)},t.createElement("div",{className:a.window,style:o({},n.window)},t.createElement("div",{className:a.cropOut,style:o({},n.cropOut)},t.createElement("div",{className:a.crop,style:o({},n.crop)},t.createElement("div",{className:a.cropIn,style:o({},n.cropIn)},t.createElement(S,{id:r.photoCrop,pcStyles:n.photoCrop}),t.createElement(v,{imgStyles:n.img,id:r.img,defaultSrc:i}),t.createElement("div",{className:a.after,style:o({},n.after)})))),t.createElement(I,{id:r.zoom,zoomStyles:n.zoom,rangeWrap:n.rangeWrap,rangeStyles:n.range,rangeVal:n.rangeVal,classNames:{rangeWrapCls:a.rangeWrap,rangeValCls:a.rangeVal}}),t.createElement(N,{id:r.buttons,ids:{buttonsId:r.buttons,inputFileId:r.inputFileBtn},classNames:{cancelBtn:a.cancelBtn,actionBtn:a.actionBtn,inputFileBtn:a.inputFileBtn},btnStyles:{actionBtnStyle:n.actionBtn,cancelBtnStyle:n.cancelBtn,buttonStyles:n.buttons,inputFileBtnStyles:n.inputFileBtn},btnNames:{cancelBtnName:s.cancelBtn,actionBtnName:s.actionBtn},rpcHandler:c}))):null)},exports.RPCStyles=r,exports.useRPC=function(){return{getDataURL:()=>R.getDataURL()}};
